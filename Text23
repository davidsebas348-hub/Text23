-- =========================
-- TOGGLE THROW KNIFE BEHIND
-- =========================

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

if _G.BEHIND_KNIFE_LOOP then
	_G.BEHIND_KNIFE_LOOP = false
	print("AUTO THROW KNIFE (KILL): OFF")
	return
end

_G.BEHIND_KNIFE_LOOP = true
print("AUTO THROW KNIFE (KILL): ON")

local MAX_DISTANCE = 1000
local BACK_DISTANCE = 5.5
local INTERVAL = 0.2

-- =========================
-- Buscar jugador mÃ¡s cercano
-- =========================
local function getClosestPlayer()

	local closest = nil
	local shortest = MAX_DISTANCE

	local myChar = LocalPlayer.Character
	if not myChar then return end

	local myHRP = myChar:FindFirstChild("HumanoidRootPart")
	if not myHRP then return end

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then

			local hrp = player.Character:FindFirstChild("HumanoidRootPart")
			local humanoid = player.Character:FindFirstChildOfClass("Humanoid")

			if hrp and humanoid and humanoid.Health > 0 then

				local dist = (hrp.Position - myHRP.Position).Magnitude

				if dist < shortest then
					shortest = dist
					closest = player
				end
			end
		end
	end

	return closest
end

-- =========================
-- Lanzar cuchillo
-- =========================
local function throwKnife()

	local myChar = LocalPlayer.Character
	if not myChar then return end

	local knife = myChar:FindFirstChild("Knife")
	if not knife then return end

	local target = getClosestPlayer()
	if not target or not target.Character then return end

	local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
	if not targetHRP then return end

	local behindPosition = targetHRP.Position - (targetHRP.CFrame.LookVector * BACK_DISTANCE)

	knife.Events.KnifeThrown:FireServer(
		CFrame.new(behindPosition),
		targetHRP.CFrame
	)
end

-- =========================
-- LOOP CONTROLADO
-- =========================
task.spawn(function()

	while _G.BEHIND_KNIFE_LOOP do
		throwKnife()
		task.wait(INTERVAL)
	end

end)
